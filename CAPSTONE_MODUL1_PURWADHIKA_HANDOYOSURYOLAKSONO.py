# Data buatan (Data Dummy) dengan Item-item data setiap karyawan
data_karyawan = [
    {
        "kode_karyawan": "KEU001",
        "nama_lengkap": "Andi Prasetyo",
        "nomor_ktp": "3201234567890123",
        "jabatan": "Manager",
        "departemen": "Keuangan",
        "tgl_mulai_kerja": "01-01-2015",
        "gaji_pokok": 15000000,
        "status_pekerjaan": "Tetap",
        "pendidikan_terakhir": "S1",
        "nomor_telepon": "081234567890",
        "alamat": "Jl. Melati No. 10, Jakarta",
        "email": "andi.prasetyo@email.com",
        "status_pernikahan": "Menikah",
        "anak": 2,
        "bpjs_kesehatan": "Aktif",
        "bpjs_ketenagakerjaan": "Aktif"
    },
    {
        "kode_karyawan": "HRD001",
        "nama_lengkap": "Siti Rahmawati",
        "nomor_ktp": "3201234567890124",
        "jabatan": "Staff",
        "departemen": "HRD",
        "tgl_mulai_kerja": "01-07-2018",
        "gaji_pokok": 8500000,
        "status_pekerjaan": "Tetap",
        "pendidikan_terakhir": "S1",
        "nomor_telepon": "081234567891",
        "alamat": "Jl. Mawar No. 20, Jakarta",
        "email": "siti.rahma@email.com",
        "status_pernikahan": "Menikah",
        "anak": 1,
        "bpjs_kesehatan": "Aktif",
        "bpjs_ketenagakerjaan": "Aktif"
    },
    {
        "kode_karyawan": "IT001",
        "nama_lengkap": "Budi Santoso",
        "nomor_ktp": "3201234567890125",
        "jabatan": "Supervisor",
        "departemen": "IT",
        "tgl_mulai_kerja": "01-05-2020",
        "gaji_pokok": 10000000,
        "status_pekerjaan": "Tetap",
        "pendidikan_terakhir": "S1",
        "nomor_telepon": "081234567892",
        "alamat": "Jl. Anggrek No. 5, Bandung",
        "email": "budi.santoso@email.com",
        "status_pernikahan": "Lajang",
        "anak": 0,
        "bpjs_kesehatan": "Aktif",
        "bpjs_ketenagakerjaan": "Aktif"
    },
    {
        "kode_karyawan": "MKT001",
        "nama_lengkap": "Rina Kartika",
        "nomor_ktp": "3201234567890126",
        "jabatan": "Staff",
        "departemen": "Marketing",
        "tgl_mulai_kerja": "01-10-2019",
        "gaji_pokok": 7500000,
        "status_pekerjaan": "Tetap",
        "pendidikan_terakhir": "D3",
        "nomor_telepon": "081234567893",
        "alamat": "Jl. Sakura No. 3, Surabaya",
        "email": "rina.kartika@email.com",
        "status_pernikahan": "Lajang",
        "anak": 0,
        "bpjs_kesehatan": "Aktif",
        "bpjs_ketenagakerjaan": "Aktif"
    },
    {
        "kode_karyawan": "LOG001",
        "nama_lengkap": "Dedi Setiawan",
        "nomor_ktp": "3201234567890127",
        "jabatan": "Admin Gudang",
        "departemen": "Logistik",
        "tgl_mulai_kerja": "01-12-2021",
        "gaji_pokok": 5500000,
        "status_pekerjaan": "Kontrak",
        "pendidikan_terakhir": "SMA",
        "nomor_telepon": "081234567894",
        "alamat": "Jl. Merpati No. 8, Bekasi",
        "email": "dedi.setiawan@email.com",
        "status_pernikahan": "Menikah",
        "anak": 3,
        "bpjs_kesehatan": "Aktif",
        "bpjs_ketenagakerjaan": "Aktif"
    },
    {
        "kode_karyawan": "KEU002",
        "nama_lengkap": "Dewi Susanti",
        "nomor_ktp": "3201234567890128",
        "jabatan": "Staff",
        "departemen": "Keuangan",
        "tgl_mulai_kerja": "01-03-2022",
        "gaji_pokok": 6500000,
        "status_pekerjaan": "Tetap",
        "pendidikan_terakhir": "S1",
        "nomor_telepon": "081234567895",
        "alamat": "Jl. Kemuning No. 7, Malang",
        "email": "dewi.susanti@email.com",
        "status_pernikahan": "Lajang",
        "anak": 0,
        "bpjs_kesehatan": "Aktif",
        "bpjs_ketenagakerjaan": "Aktif"
    },
    {
        "kode_karyawan": "OPS001",
        "nama_lengkap": "Ali Fauzan",
        "nomor_ktp": "3201234567890129",
        "jabatan": "Driver",
        "departemen": "Operasional",
        "tgl_mulai_kerja": "01-08-2020",
        "gaji_pokok": 4500000,
        "status_pekerjaan": "Kontrak",
        "pendidikan_terakhir": "SMA",
        "nomor_telepon": "081234567896",
        "alamat": "Jl. Kenanga No. 9, Bogor",
        "email": "ali.fauzan@email.com",
        "status_pernikahan": "Menikah",
        "anak": 2,
        "bpjs_kesehatan": "Aktif",
        "bpjs_ketenagakerjaan": "Aktif"
    },
    {
        "kode_karyawan": "IT002",
        "nama_lengkap": "Maria Magdalena",
        "nomor_ktp": "3201234567890130",
        "jabatan": "Staff",
        "departemen": "IT",
        "tgl_mulai_kerja": "01-04-2023",
        "gaji_pokok": 7000000,
        "status_pekerjaan": "Tetap",
        "pendidikan_terakhir": "S1",
        "nomor_telepon": "081234567897",
        "alamat": "Jl. Lili No. 15, Yogyakarta",
        "email": "maria.magdalena@email.com",
        "status_pernikahan": "Lajang",
        "anak": 0,
        "bpjs_kesehatan": "Aktif",
        "bpjs_ketenagakerjaan": "Aktif"
    }
]

# Library yang membantu proses code
import regex as re
from tabulate import tabulate
from datetime import datetime
import csv

# Daftar untuk menyimpan data yang dihapus
history_delete = []

# # # #
#  C (CREATE)
# # # #
# Fungsi untuk menambahkan data karyawan

# Fungsi input Departemen
def input_departemen(data_karyawan):
    while True:
      print()
      print("Departemen : ")
      print("1. Keuangan")
      print("2. HRD")
      print("3. IT")
      print("4. Marketing")
      print("5. Logistik")
      print("6. Operasional")
      print()
      departemen_baru = input("Masukan departemen (ketik departemen yang dituju) -(Jika anda tidak melanjutkan proses tekan 'q')- : ").title()
      if departemen_baru == 'Q':
        return None
      if departemen_baru == "Hrd" or departemen_baru == "It":
        departemen_baru = departemen_baru.replace("It","IT").replace("Hrd","HRD")
      if not membuatkodebaru(data_karyawan, departemen_baru): # Membuat kode baru
        print()
        print("Departemen tidak valid, silakan pilih dari daftar.")
        continue
      return departemen_baru

# Fungsi input nama Karyawan
def input_nama_karyawan(data_karyawan):
    while True:
      print()
      nama_baru = input("Masukan nama lengkap karyawan -(Jika anda tidak melanjutkan proses tekan 'q')- : ").title()
      if nama_baru == 'Q':
        return None
      if nama_karyawan_baru(data_karyawan, nama_baru): # Validasi nama karyawan huruf semua
        return nama_baru
      else:
        print()
        print("Nama karyawan tidak valid, coba lagi.")

# Fungsi input nomor KTP
def input_nomor_ktp(data_karyawan):
    while True:
      print()
      nomor_ktp_baru = input("Masukan nomor KTP (16 Angka) -(Jika anda tidak melanjutkan proses tekan 'q')- : ").title()
      if nomor_ktp_baru == 'Q':
        return None
      if nomor_ktp_karyawan_baru(data_karyawan, nomor_ktp_baru): # Validasi nomor ktp karyawan angka dan sebanyak 16 angka
        return nomor_ktp_baru
      else:
        print()
        print("Nomor KTP tidak valid, inputkan 16 angka.")

# Fungsi input jabatan karyawan
def input_jabatan(data_karyawan):
    while True:
      print()
      print("Jabatan : ")
      print("1. Direktur")
      print("1. Manager")
      print("2. Supervisor")
      print("3. Staff")
      print("4. Admin Gudang")
      print("5. Driver")
      print()
      jabatan_baru = input("Masukan jabatan (Huruf semua) -(Jika anda tidak melanjutkan proses tekan 'q')- : ").title()
      if jabatan_baru == 'Q':
        return None
      if jabatan_baru == "Hrd" or jabatan_baru == "It":
        jabatan_baru = jabatan_baru.replace("Hrd", "HRD").replace("It", "IT")
      if jabatan_karyawan_baru(data_karyawan, jabatan_baru): # Validasi pilihan jabatan yang sesuai
        return jabatan_baru
      else:
        print()
        print("Jabatan tidak valid, inputkan hanya huruf.")

# Fungsi input tanggal mulai kerja karyawan
def input_tgl_mulai_kerja(data_karyawan):
    while True:
      print()
      tgl_mulai_kerja_baru = input("Masukan tanggal mulai kerja (dd-mm-yyyy) -(Jika anda tidak melanjutkan proses tekan 'q')- : ").title()
      if tgl_mulai_kerja_baru == 'Q':
        return None
      if tgl_mulai_kerja_karyawan_baru(data_karyawan, tgl_mulai_kerja_baru): # Validasi tanggal mulai kerja karyawan yang sesuai
        return tgl_mulai_kerja_baru
      else:
        print()
        print("Tanggal mulai kerja tidak valid, gunakan format DD-MM-YYYY.")

# Fungsi input gaji pokok karyawan
def input_gaji_pokok(data_karyawan):
    while True:
      print()
      gaji_pokok_baru = input("Masukan gaji pokok (contoh : 10.000.000) -(Jika anda tidak melanjutkan proses tekan 'q')- : ").title()
      gaji_pokok_baru = gaji_pokok_baru.replace(".", "")
      if gaji_pokok_baru == 'Q':
        return None
      if gaji_pokok_karyawan_baru(data_karyawan, gaji_pokok_baru): # Validasi gaji pokok karyawan angka
        return gaji_pokok_baru
      else:
        print()
        print("Gaji pokok tidak valid, inputkan angka saja.")

# Fungsi input status pekerjaan
def input_status_pekerjaan(data_karyawan):
    while True:
      print()
      status_pekerjaan_baru = input("Masukan status pekerjaan (Tetap/Kontrak/Magang) -(Jika anda tidak melanjutkan proses tekan 'q')- : ").title()
      if status_pekerjaan_baru == 'Q':
        return None
      if status_pekerjaan_karyawan_baru(data_karyawan, status_pekerjaan_baru): # Validasi status pekerjaan karyawan huruf dan sesuai dengan opsi pilihan
        return status_pekerjaan_baru
      else:
        print()
        print("Status pekerjaan tidak valid, pilih antara Tetap, Kontrak, atau Magang.")

# Fungsi input pendidikan terakhir karyawan
def input_pendidikan_terakhir(data_karyawan):
    while True:
      print()
      pendidikan_terakhir_baru = input("Masukan pendidikan terakhir (SD/SMP/SMA/D3/D4/S1/S2/S3) -(Jika anda tidak melanjutkan proses tekan 'q')- : ").upper()
      if pendidikan_terakhir_baru == 'Q':
        return None
      if pendidikan_terakhir_karyawan_baru(data_karyawan, pendidikan_terakhir_baru): # Validasi pendidikan terakhir karyawan sesuai dengan opsi pilihan
        return pendidikan_terakhir_baru
      else:
        print()
        print("Pendidikan terakhir tidak valid, pilih dari SD, SMP, SMA, D3, D4, S1, S2, S3")

# Fungsi nomor telepon karyawan
def input_nomor_telepon(data_karyawan):
    while True:
      print()
      nomor_telepon_baru = input("Masukan nomor telepon (Dimulai dengan 08...) -(Jika anda tidak melanjutkan proses tekan 'q')- : ").title()
      if nomor_telepon_baru == 'Q':
          return None
      if nomor_telepon_karyawan_baru(data_karyawan, nomor_telepon_baru): # Validasi nomor telepon karyawan angka dan sebanyak 10 - 13 angka
          return nomor_telepon_baru
      else:
        print()
        print("Nomor telepon tidak valid, inputkan 10 - 13 angka yang diawali dengan 08.")

# Fungsi alamat karyawan
def input_alamat(data_karyawan):
    while True:
      print()
      print("Alamat yang dapat diterima : ")
      print("Jl. Melati No. 10, Jakarta, 12345")
      print("Jalan Raya No. 12A, Bandung, 40115")
      print("Jl. Sudirman, No 23, Surabaya, 60284-1234")
      print("Jl. Kuningan No 5-B, Jakarta Selatan, 12110")
      print("Jl. Diponegoro, Yogyakarta")
      print("Jalan Melati No. 7A/1, Jakarta, 12160")
      print("Jl. Alamat Lama 33, Cirebon, 45123, Jawa Barat")
      print()
      alamat_baru = input("Masukan alamat disesuaikan format yang diterima -(Jika anda tidak melanjutkan proses tekan 'q')- : ").title()
      if alamat_baru == 'Q':
        return None
      if alamat_karyawan_baru(data_karyawan, alamat_baru): # Validasi alamat karyawan sesuai dengan contoh-contoh alamat yang diterima
        return alamat_baru
      else:
        print()
        print("Alamat tidak valid, gunakan format yang benar.")

# Fungsi email karyawan
def input_email(data_karyawan):
    while True:
      print()
      email_baru = input("Masukan email -(Jika anda tidak melanjutkan proses tekan 'q')- : ").lower()
      if email_baru == 'q':
        return None
      if email_karyawan_baru(data_karyawan, email_baru): # Validasi email karyawan sesuai dengan format yang diterima
        return email_baru
      else:
        print()
        print("Email tidak valid, gunakan format yang benar.")

# Fungsi status pernikahan karyawan
def input_status_pernikahan(data_karyawan):
    while True:
      print()
      status_pernikahan_baru = input("Masukan status pernikahan (Menikah/Lajang) -(Jika anda tidak melanjutkan proses tekan 'q')- : ").title()
      if status_pernikahan_baru == 'Q':
        return None
      if status_pernikahan_karyawan_baru(data_karyawan, status_pernikahan_baru): # Validasi status pernikahan karyawan huruf dan sesuai dengan opsi pilihan
        return status_pernikahan_baru
      else:
        print()
        print("Status pernikahan tidak valid, pilih antara Menikah atau Lajang.")

# Fungsi jumlah anak karyawan
def input_jumlah_anak(data_karyawan):
    while True:
      print()
      anak_baru = input("Masukan jumlah anak (Angka) -(Jika anda tidak melanjutkan proses tekan 'q')- : ").lower()
      if anak_baru == 'q':
        return None
      if anak_karyawan_baru(data_karyawan, anak_baru): # Validasi jumlah anak karyawan angka
        return anak_baru
      else:
        print()
        print("Jumlah anak tidak valid, inputkan angka.")

# Fungsi BPJS kesehatan karyawan
def input_bpjs_kesehatan(data_karyawan):
    while True:
      print()
      bpjs_kesehatan_baru = input("Masukan status BPJS kesehatan (Aktif/Tidak Aktif) -(Jika anda tidak melanjutkan proses tekan 'q')- : ").title()
      if bpjs_kesehatan_baru == 'Q':
        return None
      if bpjs_kesehatan_karyawan_baru(data_karyawan, bpjs_kesehatan_baru): # Validasi status BPJS kesehatan sesuai opsi pilihan
        return bpjs_kesehatan_baru
      else:
        print()
        print("Status BPJS kesehatan tidak valid, pilih antara Aktif atau Tidak Aktif.")

# Fungsi BPJS ketenagakerjaan karyawan
def input_bpjs_ketenagakerjaan(data_karyawan):
    while True:
      print()
      bpjs_ketenagakerjaan_baru = input("Masukan status BPJS ketenagakerjaan (Aktif/Tidak Aktif) -(Jika anda tidak melanjutkan proses tekan 'q')- : ").title()
      if bpjs_ketenagakerjaan_baru == 'Q':
        return None
      if bpjs_ketenagakerjaan_karyawan_baru(data_karyawan, bpjs_ketenagakerjaan_baru): # Validasi status BPJS ketenagakerjaan sesuai opsi pilihan
        return bpjs_ketenagakerjaan_baru
      else:
        print()
        print("Status BPJS ketenagakerjaan tidak valid, pilih antara Aktif atau Tidak Aktif.")

# Fungsi CREATE DATA yang memanggil masing-masing fungsi setiap item data karyawan
def create_data(data_karyawan):
    while True:
      departemen_baru = input_departemen(data_karyawan)
      if departemen_baru is None:
          break
      nama_baru = input_nama_karyawan(data_karyawan)
      if nama_baru is None:
          break
      nomor_ktp_baru = input_nomor_ktp(data_karyawan)
      if nomor_ktp_baru is None:
          break
      jabatan_baru = input_jabatan(data_karyawan)
      if jabatan_baru is None:
          break
      tgl_mulai_kerja_baru = input_tgl_mulai_kerja(data_karyawan)
      if tgl_mulai_kerja_baru is None:
          break
      gaji_pokok_baru = input_gaji_pokok(data_karyawan)
      if gaji_pokok_baru is None:
          break
      status_pekerjaan_baru = input_status_pekerjaan(data_karyawan)
      if status_pekerjaan_baru is None:
          break
      pendidikan_terakhir_baru = input_pendidikan_terakhir(data_karyawan)
      if pendidikan_terakhir_baru is None:
          break
      nomor_telepon_baru = input_nomor_telepon(data_karyawan)
      if nomor_telepon_baru is None:
          break
      alamat_baru = input_alamat(data_karyawan)
      if alamat_baru is None:
          break
      email_baru = input_email(data_karyawan)
      if email_baru is None:
          break
      status_pernikahan_baru = input_status_pernikahan(data_karyawan)
      if status_pernikahan_baru is None:
          break
      anak_baru = input_jumlah_anak(data_karyawan)
      if anak_baru is None:
          break
      bpjs_kesehatan_baru = input_bpjs_kesehatan(data_karyawan)
      if bpjs_kesehatan_baru is None:
          break
      bpjs_ketenagakerjaan_baru = input_bpjs_ketenagakerjaan(data_karyawan)
      if bpjs_ketenagakerjaan_baru is None:
          break

      # Menyimpan data karyawan baru dalam sebuah dictionary
      data_karyawan_baru = {
          "kode_karyawan": membuatkodebaru(data_karyawan, departemen_baru),
          "nama_lengkap": nama_baru,
          "nomor_ktp": nomor_ktp_baru,
          "jabatan": jabatan_baru,
          "departemen": departemen_baru,
          "tgl_mulai_kerja": tgl_mulai_kerja_baru,
          "gaji_pokok": gaji_pokok_baru,
          "status_pekerjaan": status_pekerjaan_baru,
          "pendidikan_terakhir": pendidikan_terakhir_baru,
          "nomor_telepon": nomor_telepon_baru,
          "alamat": alamat_baru,
          "email": email_baru,
          "status_pernikahan": status_pernikahan_baru,
          "anak": anak_baru,
          "bpjs_kesehatan": bpjs_kesehatan_baru,
          "bpjs_ketenagakerjaan": bpjs_ketenagakerjaan_baru
      }

      # Menambahkan data karyawan baru ke dalam list
      data_karyawan.append(data_karyawan_baru)

      # Menampilkan pesan sukses
      print()
      print("Data karyawan berhasil ditambahkan!")
      print()

      # Menampilkan tabel data karyawan baru
      print(tabulate([data_karyawan_baru], headers="keys", tablefmt="rounded_outline"))
      break

# # # #
#  R (READ)
# # # #

# Fungsi untuk membaca dan menampilkan data karyawan
def read_data(data_karyawan):
    while True:
        if not data_karyawan:  # Mengecek apakah data_karyawan kosong
            print()
            print("Tidak ada data dalam data karyawan.")
            return  # Keluar dari fungsi jika tidak ada data

        # Pilihan data yang ingin dilihat
        print()
        print("1. Data Normal")
        print("2. Data berdasarkan gaji terendah")
        print("3. Data berdasarkan gaji tertinggi")
        print("4. Data berdasarkan lama bekerja (terlama)")
        print("5. Data berdasarkan lama bekerja (terbaru)")
        print("6. Data berdasarkan departemen")
        print("7. Exit")
        Keputusan = input("Ketikan angka pilihan apa yang anda ingin lihat: ")
        print()

        if Keputusan == "1": # Data Normal
            print(tabulate(data_karyawan, headers='keys', tablefmt='rounded_outline'))
            export_option = input("Apakah Anda ingin mengekspor data ini ke CSV? (Ya/Tidak(Halaman melihat data)) -(Ketik 'q' jika ingin ke halaman utama)- : ").title()
            if export_option == "Q":
                return
            if export_option == "Ya":
                export_to_csv(data_karyawan, filename="data_normal.csv")
        elif Keputusan == "2": # Data gaji terendah keseluruhan
            data_sorted = sorted(data_karyawan, key=lambda x: int(x["gaji_pokok"]))
            print(tabulate(data_sorted, headers='keys', tablefmt='rounded_outline'))
            export_option = input("Apakah Anda ingin mengekspor data ini ke CSV? (Ya/Tidak(Halaman melihat data)) -(Ketik 'q' jika ingin ke halaman utama)- : ").title()
            if export_option == "Q":
                return
            if export_option == "Ya":
                export_to_csv(data_sorted, filename="data_gaji_terendah.csv")
        elif Keputusan == "3": # Data gaji tertinggi keseluruhan
            data_sorted = sorted(data_karyawan, key=lambda x: int(x["gaji_pokok"]), reverse=True)
            print(tabulate(data_sorted, headers='keys', tablefmt='rounded_outline'))
            export_option = input("Apakah Anda ingin mengekspor data ini ke CSV? (Ya/Tidak(Halaman melihat data)) -(Ketik 'q' jika ingin ke halaman utama)- : ").title()
            if export_option == "Q":
                return
            if export_option == "Ya":
                export_to_csv(data_sorted, filename="data_gaji_tertinggi.csv")
        elif Keputusan == "4": # Data karyawan terlama keseluruhan bekerja
            data_sorted = sorted(data_karyawan, key=lambda x: datetime.strptime(x["tgl_mulai_kerja"], "%d-%m-%Y"))
            print(tabulate(data_sorted, headers='keys', tablefmt='rounded_outline'))
            export_option = input("Apakah Anda ingin mengekspor data ini ke CSV? (Ya/Tidak(Halaman melihat data)) -(Ketik 'q' jika ingin ke halaman utama)- : ").title()
            if export_option == "Q":
                return
            if export_option == "Ya":
                export_to_csv(data_sorted, filename="data_lama_bekerja_terlama.csv")
        elif Keputusan == "5": # Data karyawan terbaru keseluruhan bekerja
            data_sorted = sorted(data_karyawan, key=lambda x: datetime.strptime(x["tgl_mulai_kerja"], "%d-%m-%Y"), reverse=True)
            print(tabulate(data_sorted, headers='keys', tablefmt='rounded_outline'))
            export_option = input("Apakah Anda ingin mengekspor data ini ke CSV? (Ya/Tidak(Halaman melihat data)) -(Ketik 'q' jika ingin ke halaman utama)- : ").title()
            if export_option == "Q":
                return
            if export_option == "Ya":
                export_to_csv(data_sorted, filename="data_lama_bekerja_terbaru.csv")
        elif Keputusan == "6": # Data berdasarkan departemen
            # Meminta pengguna untuk memasukkan nama departemen yang ingin dilihat
            print()
            print("Departemen : ")
            print("1. Keuangan")
            print("2. HRD")
            print("3. IT")
            print("4. Marketing")
            print("5. Logistik")
            print("6. Operasional")
            print()
            departemen = input("Masukkan nama departemen yang ingin dilihat: ")
            # Mengfilter data karyawan berdasarkan departemen
            data_departemen = [karyawan for karyawan in data_karyawan if karyawan["departemen"].lower() == departemen.lower()]
            if data_departemen:
                print(tabulate(data_departemen, headers='keys', tablefmt='rounded_outline'))
                export_option = input("Apakah Anda ingin mengekspor data ini ke CSV? (Ya/Tidak(Halaman melihat data)) -(Ketik 'q' jika ingin ke halaman utama)- : ").title()
                if export_option == "Q":
                    return
                if export_option == "Ya":
                    export_to_csv(data_departemen, filename=f"data_{departemen}.csv")
            else:
                print("Tidak ada karyawan di departemen tersebut.")
        elif Keputusan == "7": # Kembali ke halaman awal
            return
        else:
            print("Pilihan tidak valid. Silakan pilih 1, 2, 3, 4, 5, 6, atau 7.")

# Fungsi untuk melihat history data yang dihapus
def lihat_history_delete_data(history_delete):
    while True:
        if not history_delete:  # Mengecek apakah history_delete kosong
            print("Tidak ada data dalam riwayat penghapusan.")
            return  # Keluar dari fungsi jika tidak ada data

        print()
        print("1. Data Normal (history delete)")
        print("2. Data berdasarkan gaji terendah (history delete)")
        print("3. Data berdasarkan gaji tertinggi (history delete)")
        print("4. Data berdasarkan lama bekerja (karyawan terlama) (history delete)")
        print("5. Data berdasarkan lama bekerja (karyawan terbaru) (history delete)")
        print("6. Data berdasarkan departemen (history delete)")
        print("7. Exit")
        Keputusan = input("Ketikan angka pilihan apa yang anda ingin lihat: ")
        print()

        if Keputusan == "1": # Data Normal (history delete)
            print(tabulate(history_delete, headers='keys', tablefmt='rounded_outline'))
            export_option = input("Apakah Anda ingin mengekspor data ini ke CSV? (Ya/Tidak(Halaman melihat history delete)) -(Ketik 'q' jika ingin ke halaman utama)- : ").title()
            if export_option == "Q":
                return
            if export_option == "Ya":
                export_to_csv(history_delete, filename="data_normal_history_delete.csv")
        elif Keputusan == "2": # Data gaji terendah keseluruhan (history delete)
            data_sorted = sorted(history_delete, key=lambda x: int(x["gaji_pokok"]))
            print(tabulate(data_sorted, headers='keys', tablefmt='rounded_outline'))
            export_option = input("Apakah Anda ingin mengekspor data ini ke CSV? (Ya/Tidak(Halaman melihat history delete)) -(Ketik 'q' jika ingin ke halaman utama)- : ").title()
            if export_option == "Q":
                return
            if export_option == "Ya":
                export_to_csv(data_sorted, filename="data_gaji_terendah_history_delete.csv")
        elif Keputusan == "3": # Data gaji tertinggi keseluruhan (history delete)
            data_sorted = sorted(history_delete, key=lambda x: int(x["gaji_pokok"]), reverse=True)
            print(tabulate(data_sorted, headers='keys', tablefmt='rounded_outline'))
            export_option = input("Apakah Anda ingin mengekspor data ini ke CSV? (Ya/Tidak(Halaman melihat history delete)) -(Ketik 'q' jika ingin ke halaman utama)- : ").title()
            if export_option == "Q":
                return
            if export_option == "Ya":
                export_to_csv(data_sorted, filename="data_gaji_tertinggi_history_delete.csv")
        elif Keputusan == "4": # Data karyawan terlama keseluruhan bekerja (history delete)
            data_sorted = sorted(history_delete, key=lambda x: datetime.strptime(x["tgl_mulai_kerja"], "%d-%m-%Y"))
            print(tabulate(data_sorted, headers='keys', tablefmt='rounded_outline'))
            export_option = input("Apakah Anda ingin mengekspor data ini ke CSV? (Ya/Tidak(Halaman melihat history delete)) -(Ketik 'q' jika ingin ke halaman utama)- : ").title()
            if export_option == "Q":
                return
            if export_option == "Ya":
                export_to_csv(data_sorted, filename="data_lama_bekerja_terlama_history_delete.csv")
        elif Keputusan == "5": # Data karyawan terbaru keseluruhan bekerja (history delete)
            data_sorted = sorted(history_delete, key=lambda x: datetime.strptime(x["tgl_mulai_kerja"], "%d-%m-%Y"), reverse=True)
            print(tabulate(data_sorted, headers='keys', tablefmt='rounded_outline'))
            export_option = input("Apakah Anda ingin mengekspor data ini ke CSV? (Ya/Tidak(Halaman melihat history delete)) -(Ketik 'q' jika ingin ke halaman utama)- : ").title()
            if export_option == "Q":
                return
            if export_option == "Ya":
                export_to_csv(data_sorted, filename="data_lama_bekerja_terbaru_history_delete.csv")
        elif Keputusan == "6": # Data berdasarkan departemen (history delete)
            # Meminta pengguna untuk memasukkan nama departemen yang ingin dilihat
            print()
            print("Departemen : ")
            print("1. Keuangan")
            print("2. HRD")
            print("3. IT")
            print("4. Marketing")
            print("5. Logistik")
            print("6. Operasional")
            print()
            departemen = input("Masukkan nama departemen yang ingin dilihat: ")
            # Mengfilter history_delete berdasarkan departemen
            data_departemen = [karyawan for karyawan in history_delete if karyawan["departemen"].lower() == departemen.lower()]
            if data_departemen:
                print(tabulate(data_departemen, headers='keys', tablefmt='rounded_outline'))
                export_option = input("Apakah Anda ingin mengekspor data ini ke CSV? (Ya/Tidak(Halaman melihat history delete)) -(Ketik 'q' jika ingin ke halaman utama)- : ").title()
                if export_option == "Q":
                    return
                if export_option == "Ya":
                    export_to_csv(data_departemen, filename=f"data_{departemen}_history_delete.csv")
            else:
                print("Tidak ada karyawan di departemen tersebut dalam riwayat penghapusan.")
        elif Keputusan == "7": # Kembali ke halaman awal
            return
        else:
            print("Pilihan tidak valid. Silakan pilih 1, 2, 3, 4, 5, 6, atau 7.")

# # # #
#  SEARCH DATA
# # # #

# Fungsi untuk mencari data karyawan berdasarkan nama dan divisi
def search_data(data_karyawan):
  print(tabulate(data_karyawan, headers='keys', tablefmt='rounded_outline'))
  while True:
      print()
      nama_karyawan = input("Masukan nama karyawan yang ingin dicari -(Ketik 'q' jika ingin keluar)- : ").lower()
      if nama_karyawan == 'q':
          return
      divisi_karyawan = input("Masukan divisi karyawan yang ingin dicari -(Ketik 'q' jika ingin keluar)- : ").lower()
      if divisi_karyawan == 'q':
          return

      # Menggunakan list comprehension untuk menyaring data
      filtered_karyawan = [search for search in data_karyawan
                          if search["nama_lengkap"].lower() == nama_karyawan and
                          search["departemen"].lower() == divisi_karyawan]

      # Jika ada hasil yang sesuai, cetak hasilnya
      if filtered_karyawan:
          print(tabulate(filtered_karyawan, headers='keys', tablefmt='rounded_outline'))
          return True
      else:
          print("Karyawan tidak ditemukan.")
          return False

# # # #
#  U (UPDATE)
# # # #

# # # FUNGSI UNTUK MENGEDIT BEBERAPA DATA KARYAWAN
# Fungsi untuk mengedit data karyawan
def edit_data(data_karyawan):
    while True:
        print()
        print(tabulate(data_karyawan, headers='keys', tablefmt='rounded_outline'))
        print()

        kode_karyawan_map = {
            "KEU": "Keuangan",
            "HRD": "HRD",
            "IT": "IT",
            "MKT": "Marketing",
            "LOG": "Logistik",
            "OPS": "Operasional"
        }

        print(kode_karyawan_map)
        print()
        # Melakukan input kode dan nama karyawan yang ingin di edit
        kode_karyawan_asli = input("Masukan kode karyawan yang ingin diubah (Contoh: KEU001) atau tekan 'q' untuk keluar: ").upper()
        if kode_karyawan_asli == 'Q':
            break
        nama_karyawan_asli = input("Masukan nama lengkap karyawan yang ingin diubah atau tekan 'q' untuk keluar: ").title()
        if nama_karyawan_asli == 'Q':
            break
        print()

        if namakaryawan(data_karyawan, nama_karyawan_asli): # Dilakukan cek apakah nama karyawan ada pada data
            if cekkode(data_karyawan, kode_karyawan_asli): # Dilakukan cek apakah kode karyawan ada pada data
                for search in data_karyawan: # Dilakukan pencarian nama dan kode karyawan yang ingin di edit
                    if search["kode_karyawan"] == kode_karyawan_asli and search["nama_lengkap"] == nama_karyawan_asli:
                        print()
                        print(tabulate([search], headers='keys', tablefmt='rounded_outline'))
                        print()
                        while True:
                            # Pilihan melakukan edit kepada salah satu item data karyawan
                            print()
                            print("Pilihan edit:")
                            print("1. Nama Karyawan")
                            print("2. Nomor KTP")
                            print("3. Departemen")
                            print("4. Jabatan")
                            print("5. Tanggal Mulai Kerja")
                            print("6. Gaji Pokok")
                            print("7. Status Pekerjaan")
                            print("8. Pendidikan Terakhir")
                            print("9. Nomor Telepon")
                            print("10. Alamat")
                            print("11. Email")
                            print("12. Status Pernikahan")
                            print("13. Jumlah Anak")
                            print("14. Status BPJS Kesehatan")
                            print("15. Status BPJS Ketenagakerjaan")
                            print("16. Exit")
                            input_edit = input("Pilih opsi untuk mengedit (1-15) atau tekan '16' untuk keluar: ")
                            print()

                            if input_edit == '16':
                                return  # Keluar dari loop edit

                            # Melakukan edit kepada salah satu item data karyawan
                            if input_edit == "1":
                              nama_karyawan = input_nama_karyawan(data_karyawan) # Memanggil fungsi input nama karyawan pada CREATE
                              if nama_karyawan is None:
                                return  # Keluar dari loop edit
                              search["nama_lengkap"] = nama_karyawan
                              print(tabulate([search], headers='keys', tablefmt='rounded_outline'))
                              bertanya = input("Apakah anda ingin melakukan edit data lagi (Ya/Tidak)").title()
                              if bertanya == "Tidak":
                                  return
                            elif input_edit == "2":
                              nomor_ktp_baru = input_nomor_ktp(data_karyawan) # Memanggil fungsi input nomor KTP karyawan pada CREATE
                              if nomor_ktp_baru is None:
                                return  # Keluar dari loop edit
                              search["nomor_ktp"] = nomor_ktp_baru
                              print(tabulate([search], headers='keys', tablefmt='rounded_outline'))
                              bertanya = input("Apakah anda ingin melakukan edit data lagi (Ya/Tidak)").title()
                              if bertanya == "Tidak":
                                  return
                            # Pilihan "3" atau mengubah departemen memiliki proses khusus
                            elif input_edit == "3":
                              departemen_baru = input_departemen(data_karyawan) # Memanggil fungsi input departemen karyawan pada CREATE
                              if departemen_baru is None:
                                return  # Keluar dari loop edit
                              search["departemen"] = departemen_baru
                              new_code = membuatkodebaru(data_karyawan, departemen_baru) # Membuat kode baru karena perpindahan departemen
                              search["kode_karyawan"] = new_code  # Ganti dengan kode baru
                              print(f"Kode karyawan diganti dengan kode baru: {new_code}")
                              print(tabulate([search], headers='keys', tablefmt='rounded_outline'))
                              bertanya = input("Apakah anda ingin melakukan edit data lagi (Ya/Tidak)").title()
                              if bertanya == "Tidak":
                                  return
                              elif bertanya == "Ya":
                                  continue

                            elif input_edit == "4":
                              jabatan_baru = input_jabatan(data_karyawan) # Memanggil fungsi input jabatan karyawan pada CREATE
                              if jabatan_baru is None:
                                return  # Keluar dari loop edit
                              search["jabatan"] = jabatan_baru
                              print(tabulate([search], headers='keys', tablefmt='rounded_outline'))
                              bertanya = input("Apakah anda ingin melakukan edit data lagi (Ya/Tidak)").title()
                              if bertanya == "Tidak":
                                  return
                            elif input_edit == "5":
                              tgl_mulai_kerja_baru = input_tgl_mulai_kerja(data_karyawan) # Memanggil fungsi input tgl mulai kerja karyawan pada CREATE
                              if tgl_mulai_kerja_baru is None:
                                return  # Keluar dari loop edit
                              search["tgl_mulai_kerja"] = tgl_mulai_kerja_baru
                              print(tabulate([search], headers='keys', tablefmt='rounded_outline'))
                              bertanya = input("Apakah anda ingin melakukan edit data lagi (Ya/Tidak)").title()
                              if bertanya == "Tidak":
                                  return
                            elif input_edit == "6":
                              gaji_pokok_baru = input_gaji_pokok(data_karyawan) # Memanggil fungsi input gaji pokok karyawan pada CREATE
                              if gaji_pokok_baru is None:
                                return  # Keluar dari loop edit
                              search["gaji_pokok"] = gaji_pokok_baru
                              print(tabulate([search], headers='keys', tablefmt='rounded_outline'))
                              bertanya = input("Apakah anda ingin melakukan edit data lagi (Ya/Tidak)").title()
                              if bertanya == "Tidak":
                                  return
                            elif input_edit == "7":
                              status_pekerjaan_baru = input_status_pekerjaan(data_karyawan) # Memanggil fungsi input status pekerjaan karyawan pada CREATE
                              if status_pekerjaan_baru is None:
                                return  # Keluar dari loop edit
                              search["status_pekerjaan"] = status_pekerjaan_baru
                              print(tabulate([search], headers='keys', tablefmt='rounded_outline'))
                              bertanya = input("Apakah anda ingin melakukan edit data lagi (Ya/Tidak)").title()
                              if bertanya == "Tidak":
                                  return
                            elif input_edit == "8":
                              pendidikan_terakhir_baru = input_pendidikan_terakhir(data_karyawan) # Memanggil fungsi input pendidikan terakhir karyawan pada CREATE
                              if pendidikan_terakhir_baru is None:
                                return  # Keluar dari loop edit
                              search["pendidikan_terakhir"] = pendidikan_terakhir_baru
                              print(tabulate([search], headers='keys', tablefmt='rounded_outline'))
                              bertanya = input("Apakah anda ingin melakukan edit data lagi (Ya/Tidak)").title()
                              if bertanya == "Tidak":
                                  return
                            elif input_edit == "9":
                              nomor_telepon_baru = input_nomor_telepon(data_karyawan) # Memanggil fungsi input nomor telepon karyawan pada CREATE
                              if nomor_telepon_baru is None:
                                return  # Keluar dari loop edit
                              search["nomor_telepon"] = nomor_telepon_baru
                              print(tabulate([search], headers='keys', tablefmt='rounded_outline'))
                              bertanya = input("Apakah anda ingin melakukan edit data lagi (Ya/Tidak)").title()
                              if bertanya == "Tidak":
                                  return
                            elif input_edit == "10":
                              alamat_baru = input_alamat(data_karyawan) # Memanggil fungsi input alamat karyawan pada CREATE
                              if alamat_baru is None:
                                return  # Keluar dari loop edit
                              search["alamat"] = alamat_baru
                              print(tabulate([search], headers='keys', tablefmt='rounded_outline'))
                              bertanya = input("Apakah anda ingin melakukan edit data lagi (Ya/Tidak)").title()
                              if bertanya == "Tidak":
                                  return
                            elif input_edit == "11":
                              email_baru = input_email(data_karyawan) # Memanggil fungsi input email karyawan pada CREATE
                              if email_baru is None:
                                return  # Keluar dari loop edit
                              search["email"] = email_baru
                              print(tabulate([search], headers='keys', tablefmt='rounded_outline'))
                              bertanya = input("Apakah anda ingin melakukan edit data lagi (Ya/Tidak)").title()
                              if bertanya == "Tidak":
                                  return
                            elif input_edit == "12":
                              status_pernikahan_baru = input_status_pernikahan(data_karyawan) # Memanggil fungsi input status pernikahan karyawan pada CREATE
                              if status_pernikahan_baru is None:
                                return  # Keluar dari loop edit
                              search["status_pernikahan"] = status_pernikahan_baru
                              print(tabulate([search], headers='keys', tablefmt='rounded_outline'))
                              bertanya = input("Apakah anda ingin melakukan edit data lagi (Ya/Tidak)").title()
                              if bertanya == "Tidak":
                                  return
                            elif input_edit == "13":
                              anak_baru = input_jumlah_anak(data_karyawan) # Memanggil fungsi input jumlah anak karyawan pada CREATE
                              if anak_baru is None:
                                return  # Keluar dari loop edit
                              search["anak"] = anak_baru
                              print(tabulate([search], headers='keys', tablefmt='rounded_outline'))
                              bertanya = input("Apakah anda ingin melakukan edit data lagi (Ya/Tidak)").title()
                              if bertanya == "Tidak":
                                  return
                            elif input_edit == "14":
                              bpjs_kesehatan_baru = input_bpjs_kesehatan(data_karyawan) # Memanggil fungsi input BPJS kesehatan karyawan pada CREATE
                              if bpjs_kesehatan_baru is None:
                                return  # Keluar dari loop edit
                              search["bpjs_kesehatan"] = bpjs_kesehatan_baru
                              print(tabulate([search], headers='keys', tablefmt='rounded_outline'))
                              bertanya = input("Apakah anda ingin melakukan edit data lagi (Ya/Tidak)").title()
                              if bertanya == "Tidak":
                                  return
                            elif input_edit == "15":
                              bpjs_ketenagakerjaan_baru = input_bpjs_ketenagakerjaan(data_karyawan) # Memanggil fungsi input BPJS ketenagakerjaan karyawan pada CREATE
                              if bpjs_ketenagakerjaan_baru is None:
                                return  # Keluar dari loop edit
                              search["bpjs_ketenagakerjaan"] = bpjs_ketenagakerjaan_baru
                              print(tabulate([search], headers='keys', tablefmt='rounded_outline'))
                              bertanya = input("Apakah anda ingin melakukan edit data lagi (Ya/Tidak)").title()
                              if bertanya == "Tidak":
                                  return
                else:
                  print("Nama karyawan dan kode karyawan tidak valid / tidak ditemukan, silakan coba lagi.")
            else:
              print("Kode karyawan tidak ditemukan.")
        else:
          print("Nama karyawan tidak ditemukan.")

# # # PENGANGKATAN KARYAWAN TETAP DATA KARYAWAN KONTRAK
# Fungsi Pengangkatan karyawan kontrak menjadi tetap
def angkat_karyawan_jadi_tetap(data_karyawan):
    # Menampilkan semua karyawan yang masih kontrak
    karyawan_kontrak = [k for k in data_karyawan if k["status_pekerjaan"].lower() == "kontrak"]

    if not karyawan_kontrak:
        print("Tidak ada karyawan kontrak yang tersedia.")
        return

    # Tampilkan tabel dengan tabulate
    print(tabulate(karyawan_kontrak, headers='keys', tablefmt="rounded_outline"))

    kode_karyawan = input("Masukkan kode karyawan yang akan diangkat jadi karyawan tetap (atau tekan Enter untuk batal): ").upper()

    # Mencari karyawan dengan kode yang dimasukkan
    for karyawan in karyawan_kontrak:
        if karyawan["kode_karyawan"] == kode_karyawan:
            karyawan["status_pekerjaan"] = "Tetap"
            print(f"{karyawan['nama_lengkap']} sekarang menjadi karyawan tetap.")
            break
    else:
        print("Kode karyawan tidak ditemukan atau batal.")

# # # #
#  D (DELETE)
# # # #

# Fungsi untuk menghapus data karyawan
def delete_data(data_karyawan):
    while True:
      print()
      print(tabulate(data_karyawan, headers='keys', tablefmt='rounded_outline'))
      print()
      # Melakukan input kode dan nama karyawan yang ingin di hapus
      kode_karyawan = input("Masukan kode karyawan yang ingin dihapus -(Tekan 'q' jika selesai)- : ").upper()
      if kode_karyawan == 'Q':
          return
      nama_karyawan = input("Masukan nama lengkap karyawan yang ingin dihapus -(Tekan 'q' jika selesai)- : ").title()
      if nama_karyawan == 'Q':
          return
      for search in data_karyawan:
          if search["kode_karyawan"] == kode_karyawan and search["nama_lengkap"] == nama_karyawan:
              search_copy = search.copy()
              history_delete.append(search_copy)  # Simpan data yang dihapus
              data_karyawan.remove(search)  # Hapus data dari list
              print("Data berikut berhasil dihapus : ")
              print(search_copy)
              break
      else:
          print("Data tidak ditemukan, silahkan inputkan kembali")

# # # #
#  EKSPOR DATA
# # # #

# Fungsi untuk mengekspor data ke CSV
def export_to_csv(data_karyawan, filename="data_karyawan.csv"):
    if not data_karyawan:
        print("Tidak ada data yang dapat diekspor.")
        return
    keys = data_karyawan[0].keys()  # Mengambil kunci dari dictionary
    with open(filename, 'w', newline='') as output_file:
        dict_writer = csv.DictWriter(output_file, fieldnames=keys)
        dict_writer.writeheader()
        dict_writer.writerows(data_karyawan)
    print(f"Data telah diekspor ke {filename}")

# # # #
#  RESTORE DATA
# # # #

# Fungsi untuk mengembalikan data karyawan yang dihapus
def restore_data(data_karyawan, history_delete):
    if not history_delete:
        print("Tidak ada data yang dapat dipulihkan.")
        return
    # Menampilkan history delete
    print("Data yang dapat dipulihkan:")
    print(tabulate(history_delete, headers='keys', tablefmt='rounded_outline'))
    # Melakukan input kode yang ingin di restore
    kode_karyawan = input("Masukkan kode karyawan yang ingin dipulihkan -(Tekan 'q' jika selesai): ").upper()
    if kode_karyawan == 'Q':
        return
    for entry in history_delete:
        if entry["kode_karyawan"] == kode_karyawan:
            # Cek apakah kode karyawan sudah ada di data_karyawan
            if any(k["kode_karyawan"] == kode_karyawan for k in data_karyawan):
                # Jika sudah ada, buat kode baru menggunakan membuatkodebaru
                new_code = membuatkodebaru(data_karyawan, entry["departemen"])  # Ganti dengan kode baru
                entry["kode_karyawan"] = new_code  # Ganti dengan kode baru
                print(f"Kode karyawan {kode_karyawan} sudah ada. Mengganti dengan kode baru: {new_code}")

            data_karyawan.append(entry)  # Tambahkan kembali ke data_karyawan
            history_delete.remove(entry)  # Hapus dari history_delete
            print(f"Data karyawan {entry['nama_lengkap']} berhasil dipulihkan dengan kode {entry['kode_karyawan']}.")
            return

    print("Kode karyawan tidak ditemukan di riwayat penghapusan.")

# # # #
#  BAGIAN VALIDASI - VALIDASI DAN NEW ITEM
# # # #

# # # BAGIAN VALIDASI - VALIDASI TERKAIT DATA KARYAWAN (DIGUNAKAN DI FUNGSI-FUNGSI SEBAGAI BERIKUT: CREATE , UPDATE)

# Fungsi validasi nama karyawan baru (validasi huruf dan spasi)
def nama_karyawan_baru(data_karyawan, nama_baru):
  nama_karyawan_replace = nama_baru.replace(" ", "")
  if nama_karyawan_replace.isalpha(): # Memastikan hanya huruf
    return True
  else:
    print()
    print("Nama karyawan tidak valid, inputkan secara lengkap (Nama Lengkap Karyawan dan perhatikan spasi)")
    return False

# Fungsi validasi nomor KTP (validasi 16 digit)
def nomor_ktp_karyawan_baru(data_karyawan, nomor_ktp_baru):
  if nomor_ktp_baru.isdigit(): # Memastikan input adalah angka
    if re.match("[0-9]{16}", nomor_ktp_baru): # Memastikan nomor KTP memiliki 16 digit angka
      return True
  else:
    print()
    print("Nomor KTP tidak valid, inputkan secara lengkap (16 angka)")
    return False

# Fungsi validasi jabatan (validasi huruf dan spasi)
def jabatan_karyawan_baru(data_karyawan, jabatan_baru):
  # print(", ".join(jabatan_pilihan))
  if jabatan_baru in ["Direktur", "Manager", "Supervisor", "Staff", "Admin Gudang", "Driver"]: # Memastikan input adalah salah satu dari pilihan
    return True
  else:
    print()
    print("Jabatan tidak valid, inputkan seseuai opsi posisi jabatan yang tersedia")
    return False

# Fungsi validasi tanggal mulai kerja (validasi format tanggal dd-mm-yyyy)
def tgl_mulai_kerja_karyawan_baru(data_karyawan, tgl_mulai_kerja_baru):
    # Memastikan format tanggal sesuai dd-mm-yyyy
    if re.match(r"^\d{2}-\d{2}-\d{4}$", tgl_mulai_kerja_baru):
        # Memisahkan komponen tanggal
        hari, bulan, tahun = map(int, tgl_mulai_kerja_baru.split('-'))

        # Memeriksa validitas tahun (misalnya, tahun tidak boleh di masa depan)
        tahun_sekarang = datetime.now().year
        if tahun < 1900 or tahun > tahun_sekarang:
            print("Tahun tidak valid. Harus antara 1900 dan tahun ini.")
            return False

        # Memeriksa validitas bulan
        if 1 <= bulan <= 12:
            # Menghitung jumlah hari dalam bulan tertentu
            if bulan in [1, 3, 5, 7, 8, 10, 12]:
                max_hari = 31
            elif bulan in [4, 6, 9, 11]:
                max_hari = 30
            else:  # bulan == 2
                # Memeriksa tahun kabisat
                if (tahun % 4 == 0 and tahun % 100 != 0) or (tahun % 400 == 0):
                    max_hari = 29
                else:
                    max_hari = 28

            # Memeriksa apakah hari valid
            if 1 <= hari <= max_hari:
                return True
            else:
                print("Hari tidak valid untuk bulan tersebut.")
                return False
        else:
            print("Bulan tidak valid. Harus antara 01 dan 12.")
            return False
    else:
        print("Tanggal mulai kerja tidak valid, inputkan secara lengkap (DD-MM-YYYY).")
        return False

# Fungsi validasi gaji pokok (validasi hanya angka dan jumlah minimum tertentu)
def gaji_pokok_karyawan_baru(data_karyawan, gaji_pokok_baru):
  # gaji_pokok_baru_replace = gaji_pokok_baru.replace(".","") # Menghapus titik untuk validasi angka
  if gaji_pokok_baru.isdigit(): # Memastikan input adalah angka
    if re.match("[0-9]{1,10}", gaji_pokok_baru):
      return True
  else:
    print()
    print("Gaji pokok tidak valid, inputkan secara lengkap (Angka)")
    return False

# Fungsi validasi status pekerjaan (validasi dari pilihan tetap/kontrak/magang)
def status_pekerjaan_karyawan_baru(data_karyawan, status_pekerjaan_baru):
  if status_pekerjaan_baru in ["Tetap","Kontrak","Magang"]: # Memastikan input adalah salah satu dari pilihan
    return True
  else:
    print()
    print("Status pekerjaan tidak valid, inputkan secara lengkap (Status Pekerjaan)")
    return False

# Fungsi validasi pendidikan terakhir (validasi dari pilihan SD/SMP/SMA/S1/S2/S3)
def pendidikan_terakhir_karyawan_baru(data_karyawan, pendidikan_terakhir_baru):
  if pendidikan_terakhir_baru in ["SD", "SMP", "SMA", "D3", "D4", "S1", "S2", "S3"]:  # Memastikan input adalah salah satu dari pilihan
    return True
  else:
    print()
    print("Pendidikan terakhir tidak valid, inputkan secara lengkap (Pendidikan Terakhir)")
    return False

# Fungsi validasi nomor telepon (validasi angka dan dimulai dengan '08')
def nomor_telepon_karyawan_baru(data_karyawan, nomor_telepon_baru):
  nomor_telepon_baru = nomor_telepon_baru.replace(" ","")
  if nomor_telepon_baru.isdigit(): # Memastikan input adalah angka
    if re.match("08[0-9]{8,11}", nomor_telepon_baru): # Memastikan nomor telepon valid dan diawali dengan '08'
      return True
  else:
    print()
    print("Nomor telepon tidak valid, inputkan secara lengkap (10 - 13 angka)")
    return False

# Fungsi validasi alamat (lebih fleksibel untuk format jalan dan kota)
def alamat_karyawan_baru(data_karyawan, alamat_baru):
    # Pola yang lebih fleksibel: memperbolehkan variasi dalam penulisan alamat
    pola = r"^(?:.*(?:Jalan|Jl\.?)\s+[A-Za-z0-9\s.,/-]+(?:\s+No\.?\s*\d+[A-Za-z/-]*)?),?\s*([A-Za-z0-9\s.,-]+)(?:,\s*(\d{5}(-\d{4})?))?(?:,\s*([A-Za-z0-9\s.,-]+))?$"

    if re.match(pola, alamat_baru):
        return True
    else:
        print()
        print("Alamat tidak valid, pastikan formatnya lengkap")
        return False

# Fungsi validasi email (validasi format email)
def email_karyawan_baru(data_karyawan, email_baru):
  if re.match("[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]*\.[a-zA-Z]{2,}\.*[a-zA-Z]*\.*[a-zA-Z]*", email_baru): # Memastikan format email valid
    return True
  else:
    print()
    print("Email tidak valid, inputkan secara lengkap (Email)")
    return False

# Fungsi validasi status pernikahan (validasi dari pilihan menikah/lajang)
def status_pernikahan_karyawan_baru(data_karyawan, status_pernikahan_baru):
  if status_pernikahan_baru in ["Menikah", "Lajang"]:  # Memastikan input adalah salah satu dari pilihan
    return True
  else:
    print()
    print("Status pernikahan tidak valid, inputkan secara lengkap (Status Pernikahan)")
    return False

# Fungsi validasi jumlah anak (validasi input angka)
def anak_karyawan_baru(data_karyawan, anak_baru):
  if anak_baru.isdigit(): # Memastikan input adalah angka
    if re.match("[0-9]{1,2}", anak_baru): # Memastikan input adalah angka
      return True
  else:
    print()
    print("Jumlah anak tidak valid, inputkan secara lengkap (Jumlah Anak)")
    return False

# Fungsi validasi BPJS Kesehatan (validasi dari pilihan aktif/tidak aktif)
def bpjs_kesehatan_karyawan_baru(data_karyawan, bpjs_kesehatan_baru):
  bpjs_kesehatan_baru_replace = bpjs_kesehatan_baru.replace(" ","")
  if bpjs_kesehatan_baru_replace in ["Aktif", "Tidak Aktif"]:  # Memastikan input adalah salah satu dari pilihan
    return True
  else:
    print()
    print("Status BPJS kesehatan tidak valid, inputkan secara lengkap (Status BPJS Kesehatan)")
    return False

# Fungsi validasi BPJS Ketenagakerjaan (validasi dari pilihan aktif/tidak aktif)
def bpjs_ketenagakerjaan_karyawan_baru(data_karyawan, bpjs_ketenagakerjaan_baru):
  bpjs_ketenagakerjaan_baru_replace = bpjs_ketenagakerjaan_baru.replace(" ","")
  if bpjs_ketenagakerjaan_baru_replace in ["Aktif", "Tidak Aktif"]:  # Memastikan input adalah salah satu dari pilihan
    return True
  else:
    print()
    print("Status BPJS ketenagakerjaan tidak valid, inputkan secara lengkap (Status BPJS Ketenagakerjaan)")
    return False

# # # MEMBUAT KODE BARU DENGAN INPUT DEPARTEMEN BARU (DIGUNAKAN DI FUNGSI-FUNGSI SEBAGAI BERIKUT: CREATE , UPDATE , RESTORE DATA)

# Fungsi untuk membuat kode baru berdasarkan departemen
def membuatkodebaru(data_karyawan, departemen_baru):
    # Peta kode departemen
    kode_departemen_map = {
        "Keuangan": "KEU",
        "HRD": "HRD",
        "IT": "IT",
        "Marketing": "MKT",
        "Logistik": "LOG",
        "Operasional": "OPS"
    }

    # Memeriksa apakah departemen valid
    if departemen_baru not in kode_departemen_map:
        print()
        print("Departemen tidak valid.")
        return False

    # Mendapatkan kode departemen
    departemen_kode = kode_departemen_map[departemen_baru]

    # Mengumpulkan nomor yang sudah ada
    existing_numbers = [
        int(karyawan["kode_karyawan"][3:])  # Ambil bagian nomor setelah kode departemen
        for karyawan in data_karyawan if karyawan["kode_karyawan"].startswith(departemen_kode)
    ]

    # Jika tidak ada karyawan di departemen tersebut, mulai dari 1
    if not existing_numbers:
        return f"{departemen_kode}001"

    # Temukan nomor terkecil yang belum digunakan
    next_number = 1
    while next_number in existing_numbers:
        next_number += 1

    # Kode karyawan baru yang akan digunakan
    kode_karyawan_baru = f"{departemen_kode}{next_number:03d}"

    return kode_karyawan_baru  # Mengembalikan kode karyawan baru

# # # VALIDASI KODE KARYAWAN SESUAI DEPARTEMEN

# Fungsi untuk memeriksa validitas kode karyawan
def cekkode(data_karyawan, kode_karyawan_asli):
    kode_karyawan_map = {
        "KEU": "Keuangan",
        "HRD": "HRD",
        "IT": "IT",
        "MKT": "Marketing",
        "LOG": "Logistik",
        "OPS": "Operasional"
    }

    # Memeriksa pola kode karyawan
    if re.match("[A-Z]{2,3}[0-9]{3}", kode_karyawan_asli):
        kode_pisah = re.match(r"([A-Z]+)(\d+)", kode_karyawan_asli)
        if kode_pisah:
            huruf = kode_pisah.group(1)
            departemen_kode = kode_karyawan_map[huruf]
            if kode_pisah.group(1) in kode_karyawan_map:
                print(f"Huruf pada kode sesuai dengan departemen {departemen_kode}")
                return True
            else:
                print(f"Huruf pada kode tidak sesuai kode awal ketentuan setiap departemen, inputkan tiga huruf awal kode departemen secara benar (contoh Departemen Keuangan : KEU001)")
    else:
        print("Kode yang anda masukan tidak sesuai ketentuan (CONTOH : KEU001)")

# # # VALIDASI NAMA KARYAWAN SESUAI DATA KARYAWAN

# Fungsi untuk memeriksa nama karyawan
def namakaryawan(data_karyawan, nama_karyawan_asli):
  if any(nama_karyawan_asli == search["nama_lengkap"] for search in data_karyawan):
      return True
  else:
      print("Nama karyawan tidak ada, inputkan secara lengkap (Nama Lengkap Karyawan dan perhatikan spasi)")
      return False


# # # #
#  MAIN
# # # #

# Menu utama
# Tambahkan pilihan di menu utama
def main():
    while True:
        print()
        print("Menu:")
        print("1. Tambah Data Karyawan")
        print("2. Lihat Data Karyawan")
        print("3. Cari Data Karyawan")
        print("4. Hapus Data Karyawan")
        print("5. Lihat History Data yang Dihapus")
        print("6. Edit Data Karyawan")
        print("7. Ekspor Data Karyawan")
        print("8. Restore Data Karyawan")
        print("9. Pengangkatan Karyawan Jadi Tetap")  # Menu baru untuk pengangkatan
        print("10. Keluar")
        choice = input("Pilih menu (1-10): ")

        if choice == '1':
            create_data(data_karyawan)
        elif choice == '2':
            read_data(data_karyawan)
        elif choice == '3':
            search_data(data_karyawan)
        elif choice == '4':
            delete_data(data_karyawan)
        elif choice == '5':
            lihat_history_delete_data(history_delete)
        elif choice == '6':
            edit_data(data_karyawan)
        elif choice == '7':
            export_to_csv(data_karyawan, filename="data_karyawan.csv")
        elif choice == '8':
            restore_data(data_karyawan, history_delete)
        elif choice == '9':  # Pilihan untuk pengangkatan status karyawan dalam bekerja
            angkat_karyawan_jadi_tetap(data_karyawan)
        elif choice == '10':
            print("Terima kasih! Program selesai.")
            break
        else:
            print("Pilihan tidak valid.")

if __name__ == "__main__":
    main()
